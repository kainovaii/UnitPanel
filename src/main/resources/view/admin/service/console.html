{% extends "layout/admin.html" %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="page-header d-print-none p-0 mb-3" aria-label="Page header">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h1 style="font-size: 30px;"><span x-text="title">{{ service.name }}</span></h1>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <span class="d-none d-sm-inline">
                                    <a href="#" class="btn btn-md" onclick="startService('{{ service.unit }}')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-player-play"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 4v16l13 -8l-13 -8" /></svg>
                                        Start
                                    </a>
                                    <a href="#" class="btn btn-md" onclick="stopService('{{ service.unit }}')">
                                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-player-stop"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 5m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" /></svg>
                                        Stop
                                    </a>
                                    <a href="#" class="btn btn-md btn-primary" onclick="restartService('{{ service.unit }}')">
                                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-repeat"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 12v-3a3 3 0 0 1 3 -3h13m-3 -3l3 3l-3 3" /><path d="M20 12v3a3 3 0 0 1 -3 3h-13m3 3l-3 -3l3 -3" /></svg>
                                        Restart
                                    </a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12">
            <pre id="logBox" style="width:100%; height:750px !important; overflow:auto; background:#000; color:#0f0; padding:10px;"></pre>
        </div>
    </div>
</div>

<script>
    function startService(unit) {
        fetch(`/api/systemd/${unit}/start`, { method: 'POST' })
            .then(r => r.text())
            .then(console.log);
    }

    function stopService(unit) {
        fetch(`/api/systemd/${unit}/stop`, { method: 'POST' })
            .then(r => r.text())
            .then(console.log);
    }

    function restartService(unit) {
        stopService(unit);
        setTimeout(() => startService(unit), 500);
    }

    function showLogs(unit) {
        const logBox = document.getElementById('logBox');
        fetch(`/api/systemd/${unit}/logs`)
            .then(r => r.text())
            .then(text => logBox.textContent = text);
    }

    let logInterval;
    function liveLogs(unit) {
        if(logInterval) clearInterval(logInterval);
        const logBox = document.getElementById('logBox');
        logInterval = setInterval(() => {
            fetch(`/api/systemd/${unit}/logs`)
                .then(r => r.text())
                .then(text => {
                    logBox.textContent = text;
                    logBox.scrollTop = logBox.scrollHeight; // <-- scroll en bas
                });
        }, 2000);
    }

    document.addEventListener("DOMContentLoaded", () => liveLogs('{{ service.unit }}'));
</script>
{% endblock %}
