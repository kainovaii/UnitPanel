{% extends "layout/admin.html" %}

{% block content %}
<div class="page-body">
    <div class="container-xxl">
        <!-- Header -->
        <div class="page-header d-print-none mb-4">
            <div class="row g-2 align-items-center">
                <div class="col">
                    <div class="page-pretitle">
                        Documentation
                    </div>
                    <h2 class="page-title">
                        API Reference
                    </h2>
                </div>
                <div class="col-auto ms-auto">
                    <div class="btn-list">
                        <span class="badge bg-azure-lt">v1.0.0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row row-deck row-cards">
            <!-- Authentication Section -->
            <div class="col-12">
                <div class="card bg-blue-lt">
                    <div class="card-header">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-lock me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z" /><path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0" /><path d="M8 11v-4a4 4 0 1 1 8 0v4" /></svg>
                        <h3 class="card-title">API Token</h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Generate an API token to use with external applications.</p>
                        <a href="/account" class="btn btn-primary" id="generateTokenBtn">Generate New Token</a>
                    </div>
                </div>
            </div>

            <!-- Endpoints -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Available Endpoints</h3>
                    </div>
                    <div class="card-table table-responsive">
                        <table class="table table-vcenter">
                            <thead>
                            <tr>
                                <th>Method</th>
                                <th>Endpoint</th>
                                <th>Description</th>
                                <th class="w-1"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td colspan="4" class=""><strong>Service Management</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/start</code></td>
                                <td>Start a systemd service</td>
                                <td><a href="#endpoint-start">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/stop</code></td>
                                <td>Stop a systemd service</td>
                                <td><a href="#endpoint-stop">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/status</code></td>
                                <td>Get service status</td>
                                <td><a href="#endpoint-status">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/logs</code></td>
                                <td>Retrieve service logs</td>
                                <td><a href="#endpoint-logs">View</a></td>
                            </tr>
                            <tr>
                                <td colspan="4" class=""><strong>Statistics</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/stats</code></td>
                                <td>Statistics for a specific service</td>
                                <td><a href="#endpoint-stats">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/stats/total</code></td>
                                <td>Total statistics for services</td>
                                <td><a href="#endpoint-total-stats">View</a></td>
                            </tr>
                            <tr>
                                <td colspan="4" class=""><strong>File Management</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/files</code></td>
                                <td>List files in working directory</td>
                                <td><a href="#endpoint-files">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/file</code></td>
                                <td>Read file content</td>
                                <td><a href="#endpoint-get-file">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/file</code></td>
                                <td>Save a file</td>
                                <td><a href="#endpoint-save-file">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/service-file</code></td>
                                <td>Read a .service file</td>
                                <td><a href="#endpoint-service-file-get">View</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/service-file</code></td>
                                <td>Update a .service file</td>
                                <td><a href="#endpoint-service-file-update">View</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- POST /api/systemd/:unit/start -->
            <div class="col-lg-6" id="endpoint-start">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/start
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Start a specific systemd service.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.yourdomain.com/api/systemd/nginx/start" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/stop -->
            <div class="col-lg-6" id="endpoint-stop">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/stop
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Stop a specific systemd service.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.yourdomain.com/api/systemd/nginx/stop" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/status -->
            <div class="col-lg-6" id="endpoint-status">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/status
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Get the current status of a systemd service.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/nginx/status" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "status": "active"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/logs -->
            <div class="col-lg-6" id="endpoint-logs">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/logs
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Retrieve service logs (last 200 lines).</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/nginx/logs" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response format</h4>
                        <p class="text-muted">Response in <code>text/plain</code> containing the logs.</p>
                        <pre class="bg-dark text-white p-3 rounded"><code>Status: active
Jan 12 10:30:00 server nginx[1234]: Starting nginx...
Jan 12 10:30:01 server nginx[1234]: nginx started</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/stats -->
            <div class="col-lg-6" id="endpoint-stats">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/stats
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">CPU and RAM statistics for a service.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/nginx/stats" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "cpu": 2.5,
  "mem": 1.8,
  "ram": "256.00 MB"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/stats/total -->
            <div class="col-lg-6" id="endpoint-total-stats">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/stats/total
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Total statistics. Without parameters, aggregates all services in the database.</p>

                        <h4 class="mt-4">Parameters (optional)</h4>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td><code>units</code></td>
                                    <td>Comma-separated list (e.g., nginx,postgresql)</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/stats/total?units=nginx,postgresql" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "cpu": 8.75,
  "mem": 12.50,
  "ram": "2.10 GB",
  "count": 2
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/files -->
            <div class="col-lg-6" id="endpoint-files">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/files
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">List the file tree of the working directory.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/nginx/files" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "files": [
    "/var/www/index.html",
    "/var/www/config.json"
  ],
  "baseDir": "/var/www"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/file -->
            <div class="col-lg-6" id="endpoint-get-file">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Read the content of a file.</p>

                        <h4 class="mt-4">Parameters</h4>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td><code>path</code></td>
                                    <td>Full path to the file</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/nginx/file?path=/var/www/index.html" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <p class="text-muted">Raw file content in <code>text/plain</code>.</p>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/file -->
            <div class="col-lg-6" id="endpoint-save-file">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Save file content.</p>

                        <h4 class="mt-4">Parameters</h4>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td><code>path</code></td>
                                    <td>Full path to the file (query param)</td>
                                </tr>
                                <tr>
                                    <td><code>body</code></td>
                                    <td>Content to write (body)</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.yourdomain.com/api/systemd/nginx/file?path=/var/www/index.html" \
  -H "Authorization: Bearer your-token" \
  --data-binary @index.html</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true,
  "message": "File saved successfully"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/service-file -->
            <div class="col-lg-6" id="endpoint-service-file-get">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/service-file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Read a .service file from <code>/etc/systemd/system/</code>.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.yourdomain.com/api/systemd/nginx/service-file" \
  -H "Authorization: Bearer your-token"</code></pre>

                        <h4 class="mt-4">Response (text/plain)</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>[Unit]
Description=Nginx Web Server
After=network.target

[Service]
Type=simple
ExecStart=/usr/sbin/nginx
WorkingDirectory=/var/www
User=www-data
Restart=on-failure
RestartSec=10s

[Install]
WantedBy=multi-user.target</code></pre>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/service-file -->
            <div class="col-lg-6" id="endpoint-service-file-update">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/service-file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Update a .service file and automatically reload systemd.</p>

                        <h4 class="mt-4">Request body</h4>
                        <p class="text-muted">Send the complete .service file content as <code>text/plain</code> in the body.</p>

                        <h4 class="mt-4">Request example</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.yourdomain.com/api/systemd/nginx/service-file" \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: text/plain" \
  --data-binary @nginx.service</code></pre>

                        <h4 class="mt-4">Response</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true,
  "message": "Service file updated successfully"
}</code></pre>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    code {
        color: #e83e8c;
        background-color: rgba(232, 62, 140, 0.1);
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.875em;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }

    pre code {
        color: inherit;
        background-color: transparent;
        padding: 0;
        font-size: 0.875rem;
        line-height: 1.5;
    }

    pre {
        margin: 0;
        overflow-x: auto;
    }

    .bg-dark {
        background-color: #0A1422 !important;
    }

    .badge {
        color: white;
    }
</style>

{% endblock %}