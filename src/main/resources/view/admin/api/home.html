{% extends "layout/admin.html" %}

{% block content %}
<div class="page-body">
    <div class="container-xxl">
        <!-- Header -->
        <div class="page-header d-print-none mb-4">
            <div class="row g-2 align-items-center">
                <div class="col">
                    <div class="page-pretitle">
                        Documentation
                    </div>
                    <h2 class="page-title">
                        API Reference
                    </h2>
                </div>
                <div class="col-auto ms-auto">
                    <div class="btn-list">
                        <span class="badge bg-azure-lt">v1.0.0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row row-deck row-cards">
            <!-- Endpoints -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Endpoints disponibles</h3>
                    </div>
                    <div class="card-table table-responsive">
                        <table class="table table-vcenter">
                            <thead>
                            <tr>
                                <th>Méthode</th>
                                <th>Endpoint</th>
                                <th>Description</th>
                                <th class="w-1"></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td colspan="4" class=""><strong>Gestion des Services</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/start</code></td>
                                <td>Démarrer un service systemd</td>
                                <td><a href="#endpoint-start">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/stop</code></td>
                                <td>Arrêter un service systemd</td>
                                <td><a href="#endpoint-stop">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/status</code></td>
                                <td>Obtenir le statut d'un service</td>
                                <td><a href="#endpoint-status">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/logs</code></td>
                                <td>Récupérer les logs d'un service</td>
                                <td><a href="#endpoint-logs">Voir</a></td>
                            </tr>
                            <tr>
                                <td colspan="4" class=""><strong>Statistiques</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/stats</code></td>
                                <td>Statistiques d'un service spécifique</td>
                                <td><a href="#endpoint-stats">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/stats/total</code></td>
                                <td>Statistiques totales des services</td>
                                <td><a href="#endpoint-total-stats">Voir</a></td>
                            </tr>
                            <tr>
                                <td colspan="4" class=""><strong>Gestion des Fichiers</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/files</code></td>
                                <td>Lister les fichiers du répertoire de travail</td>
                                <td><a href="#endpoint-files">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/file</code></td>
                                <td>Lire le contenu d'un fichier</td>
                                <td><a href="#endpoint-get-file">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/file</code></td>
                                <td>Sauvegarder un fichier</td>
                                <td><a href="#endpoint-save-file">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/systemd/:unit/service-file</code></td>
                                <td>Lire un fichier .service</td>
                                <td><a href="#endpoint-service-file-get">Voir</a></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-green">POST</span></td>
                                <td><code>/api/systemd/:unit/service-file</code></td>
                                <td>Modifier un fichier .service</td>
                                <td><a href="#endpoint-service-file-update">Voir</a></td>
                            </tr>
                            <!--
                            <tr>
                                <td colspan="4" class=""><strong>Services en Base de données</strong></td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-blue">GET</span></td>
                                <td><code>/api/services</code></td>
                                <td>Lister tous les services en BDD</td>
                                <td><a href="#endpoint-services-list">Voir</a></td>
                            </tr>
                            -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/start -->
            <div class="col-lg-6" id="endpoint-start">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/start
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Démarre un service systemd spécifique.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.votredomaine.com/api/systemd/nginx/start"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/stop -->
            <div class="col-lg-6" id="endpoint-stop">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/stop
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Arrête un service systemd spécifique.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.votredomaine.com/api/systemd/nginx/stop"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/status -->
            <div class="col-lg-6" id="endpoint-status">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/status
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Récupère le statut actuel d'un service systemd.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/nginx/status"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "status": "active"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/logs -->
            <div class="col-lg-6" id="endpoint-logs">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/logs
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Récupère les logs d'un service (200 dernières lignes).</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/nginx/logs"</code></pre>

                        <h4 class="mt-4">Format de réponse</h4>
                        <p class="text-muted">Réponse en <code>text/plain</code> contenant les logs.</p>
                        <pre class="bg-dark text-white p-3 rounded"><code>Status: active
Jan 12 10:30:00 server nginx[1234]: Starting nginx...
Jan 12 10:30:01 server nginx[1234]: nginx started</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/stats -->
            <div class="col-lg-6" id="endpoint-stats">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/stats
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Statistiques CPU et RAM d'un service.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/nginx/stats"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "cpu": 2.5,
  "mem": 1.8,
  "ram": "256.00 MB"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/stats/total -->
            <div class="col-lg-6" id="endpoint-total-stats">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/stats/total
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Statistiques totales. Sans paramètres, agrège tous les services en BDD.</p>

                        <h4 class="mt-4">Paramètres (optionnel)</h4>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td><code>units</code></td>
                                    <td>Liste séparée par virgules (ex: nginx,postgresql)</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/stats/total?units=nginx,postgresql"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "cpu": 8.75,
  "mem": 12.50,
  "ram": "2.10 GB",
  "count": 2
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/files -->
            <div class="col-lg-6" id="endpoint-files">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/files
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Liste l'arborescence des fichiers du répertoire de travail.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/nginx/files"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "files": [
    "/var/www/index.html",
    "/var/www/config.json"
  ],
  "baseDir": "/var/www"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/systemd/:unit/file -->
            <div class="col-lg-6" id="endpoint-get-file">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Lit le contenu d'un fichier.</p>

                        <h4 class="mt-4">Paramètres</h4>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td><code>path</code></td>
                                    <td>Chemin complet du fichier</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/nginx/file?path=/var/www/index.html"</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <p class="text-muted">Contenu brut du fichier en <code>text/plain</code>.</p>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/file -->
            <div class="col-lg-6" id="endpoint-save-file">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Sauvegarde le contenu d'un fichier.</p>

                        <h4 class="mt-4">Paramètres</h4>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                <tr>
                                    <td><code>path</code></td>
                                    <td>Chemin complet du fichier (query param)</td>
                                </tr>
                                <tr>
                                    <td><code>body</code></td>
                                    <td>Contenu à écrire (body)</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.votredomaine.com/api/systemd/nginx/file?path=/var/www/index.html" \
  --data-binary @index.html</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true,
  "message": "File saved successfully"
}</code></pre>
                    </div>
                </div>
            </div>

            <!-- GET /api/services -->
            <!--
            <div class="col-lg-12" id="endpoint-services-list">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/services
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6">
                                <p class="text-muted">Liste tous les services enregistrés dans la base de données.</p>

                                <h4 class="mt-4">Exemple de requête</h4>
                                <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/services"</code></pre>
                            </div>
                            <div class="col-lg-6">
                                <h4>Exemple de réponse</h4>
                                <pre class="bg-dark text-white p-3 rounded" style="height: 400px; overflow-y: auto;"><code>{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Nginx Web Server",
      "unit": "nginx",
      "description": "High performance web server",
      "workingDirectory": "/var/www",
      "user": "www-data",
      "execStart": "/usr/sbin/nginx"
    },
    {
      "id": 2,
      "name": "PostgreSQL Database",
      "unit": "postgresql",
      "description": "PostgreSQL database server",
      "workingDirectory": "/var/lib/postgresql",
      "user": "postgres",
      "execStart": "/usr/lib/postgresql/14/bin/postgres"
    }
  ],
  "total": 2
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            -->

            <!-- GET /api/systemd/:unit/service-file -->
            <div class="col-lg-6" id="endpoint-service-file-get">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-blue me-2">GET</span>
                            /api/systemd/:unit/service-file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Lit le contenu d'un fichier .service depuis <code>/etc/systemd/system/</code>.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X GET "https://api.votredomaine.com/api/systemd/nginx/service-file"</code></pre>

                        <h4 class="mt-4">Réponse (text/plain)</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>[Unit]
Description=Nginx Web Server
After=network.target

[Service]
Type=simple
ExecStart=/usr/sbin/nginx
WorkingDirectory=/var/www
User=www-data
Restart=on-failure
RestartSec=10s

[Install]
WantedBy=multi-user.target</code></pre>
                    </div>
                </div>
            </div>

            <!-- POST /api/systemd/:unit/service-file -->
            <div class="col-lg-6" id="endpoint-service-file-update">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="badge bg-green me-2">POST</span>
                            /api/systemd/:unit/service-file
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">Modifie un fichier .service et recharge systemd automatiquement.</p>

                        <h4 class="mt-4">Corps de la requête</h4>
                        <p class="text-muted">Envoyer le contenu complet du fichier .service en <code>text/plain</code> dans le body.</p>

                        <h4 class="mt-4">Exemple de requête</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>curl -X POST "https://api.votredomaine.com/api/systemd/nginx/service-file" \
  -H "Content-Type: text/plain" \
  --data-binary @nginx.service</code></pre>

                        <h4 class="mt-4">Réponse</h4>
                        <pre class="bg-dark text-white p-3 rounded"><code>{
  "success": true,
  "message": "Service file updated successfully"
}</code></pre>

                        <div class="alert alert-warning mt-3">
                            <strong>Note :</strong> Le daemon systemd est rechargé automatiquement. Pensez à redémarrer le service pour appliquer les changements.
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    code {
        color: #e83e8c;
        background-color: rgba(232, 62, 140, 0.1);
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.875em;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }

    pre code {
        color: inherit;
        background-color: transparent;
        padding: 0;
        font-size: 0.875rem;
        line-height: 1.5;
    }

    pre {
        margin: 0;
        overflow-x: auto;
    }

    .bg-dark {
        background-color: #1e293b !important;
    }
</style>

{% endblock %}